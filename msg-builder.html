<script>
    function build()
    {
        const code = document.getElementById('code').value
        
        let result = ''
        
        result += 'bits: ' + code2bits(code) + "\n"
        result += 'hex : ' + code2hex(code) + "\n"
        
        document.getElementById('output').value = result
    }
    
    function code2bits(code)
    {
        code = code.replace(/\n+/g, "\n")
        const lines = code.trim().split("\n")
        console.log(lines)
        
        let bits = ''
        
        for(const p of lines){
            if(p[0] == '#') continue
            
            if(p.match(/^\[\d+\]\s*\d+.*$/)){
                const size  = p.match(/^\[(\d+)\]/)[1]
                const value = p.match(/^\[\d+\]\s*(\d+)/)[1]
                console.log(size)
                console.log(value)
                const valueBinary = parseInt(value).toString(2)
                if(valueBinary.length <= size){
                    bits += valueBinary.padStart(size, '0')
                }
                else{
                    alert('overflow: '+ value + ' needs ' + valueBinary.length + ' bits')
                    bits += '#overflow'
                }
                bits += ' '
            }
            else{
                alert('wrong format: ' + p)
            }
        }
        
        return bits
    }
    
    function code2hex(code)
    {
        const bits = code2bits(code)
        const binaryString = bits.replace(/\s+/g, '')
        
        var output = ''

        // For every 4 bits in the binary string
        for (var i=0; i < binaryString.length; i+=4)
        {
            // Grab a chunk of 4 bits
            var bytes = binaryString.substr(i, 4)
            console.log('bytes', bytes)

            // Convert to decimal then hexadecimal
            var decimal = parseInt(bytes, 2)
            console.log('decimal', decimal)
            var hex = decimal.toString(16)
            console.log('hex', hex)

            // Uppercase all the letters and append to output
            output += hex.toUpperCase();
        }

        return output;          
    }
    
</script>


<br>
<br>
<br>
<br>

<textarea id=code cols=60 rows=20>

# сообщение OFTEN (1 фаза)


[4] 0  cmd
[6] 0  год
[4] 11 месяц
[5] 18 день
[5] 23 час
[1] 1  получас

[3] 2  номер тарифа
[23] 0 актив
[23] 8388607 реакт
[6] 0 напр


</textarea>

<br>
<br>
<button onclick="build()">BUILD</button>

<br>
<br>

<textarea id=output cols=200 rows=5>
</textarea>
