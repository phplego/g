<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QwKDBMQvXsApgAABtBJREFUWMONl1tsHGcVx39nvl3n5svmQuLEbps6F1MnTlIIoYSQNqoQUqOi0vYhakEKUvuCirhIeaA0SlouEhWlAkGBwFNaqVAeitKQIAEtYLVqipWEhLZK4sa52LFNG9vBjuOdb2b+PMzuene9TnKk0c43O985/znnfy6fMYN4Z2RjVawBKywDoAHIATEwAkwAxQ0q7i3sq9BVLnYj496ZARngduAh4Atgn8AFDQAkCUgAQ8AR4CBwALgMROVAaoGwasPlaL2zOuBOYDewHYBYsHgReuhhWLwYDhzATp6AujoIAvAe4jhE+i3wY+BiNlZ0PRAl40UAhfVS7+xZ70wVF8jfuUHxW29JkvyePcqDwl++oPDNN5X/6k75xnr5AHlnE97ZY95Zw0yhDsoXZV/eAfwO2IVz6dcBJAX0zUugeQkJwAdnsHlzcGs7yW7eTNDZCZlMkQ1zgN8Az3lni8q9XJRMjZivAV5B6iCbRes3YJs2oaNHscEBGBmBFSuhpQUNDUJfH7S1QVMjAnTyJHb1ajW7HgcWeWePZWMNl9vLVBlvLSDuQMDcudiOHWS+9e1U+eQkyfFjMK8e6mbB6BU0fwHW/nFYsBAB9sFZyPsUQCWILwHD3tkT2ViT0/jgnc32zn5eirUhv/hj8j95TvHAgOLRUSWSEkmxpDiKCveJovFxxd4ryuflv/6EfMcdKQ+gyIXy6/FpofDOzDu7ZxrhshmFLcuUv3urwh/+QP7DD1Pjcaw4SRRPTiqO4xKwIrjo3DmFT+9V2Lm2FoDRgqenQHhns7yzf0wDUGQ9yK9eJd/VNQVAkv/TQfmf/VTRoUOKjx1TPHG1Aozv7lb42c3ymaBa7y9KAArpt7Gm8XIQd29VdPFiCkBSND4u//CD8qAQFK5dI//976XhSpKSZ/yx4/JLl9TyQq6YhgZ8mRvJooXQ2gpSyq2+PhgZTatZAPafd9FTu0n++CoWhmCG4phgw3q0cVNapKakEfhieR24b0bDEnIBtLSmL6vA3P5+NDRUqKcGzjBA53rR5GT6zNJntLam60q5r1gHGoFVMwMA5uegbUXl4/5+ONdLqTwDygbYXZuhvr4EVADvv5f2jMoWsLEI4Nbrul5AriktNmWPbP16eGo3XLiA+vuwOIF77yXYdg84h0kQBMRd/8T+fXzKc1PS7J1ZBlhwo/BbUw5rayv1WiSCdetg3ToURaivL63rt92WuloiuTaBXn8DPfM0NjY2UxvIZbgZaWqElYUQBAG6coXk9GksCGD1KoLlyzFIe0OSpO/EEcnLLxP8q7tAdavlWzLA8A0BLGnGZs2eUt7bi579EZw5A0ubiZc0w6c2YTt2YAsXph6aMw927ULne7F33qnmQHFoGcE7a5wx/wPk6+fKf/fJtMoVClB08KDCW28pFakQFC7IKbz/fkU9PRXFKuzqUthQX0t/TzEO48DpWulHAjQ0pN2vfIIZHIShoXThDHOGDY9ir72G3ngd8vnU5UmC27IlzaDKEAjoLgIQcLjaeMljdXXQ2ZkGzCztipf6sXwIQZlSl/5HXR24oBJwrqlW/A8XOSDgReAbpaGjZRnBK3+AS/1QN4tgw4bUI2ZoZASdOpUqrhqvtKYD98mNkMmWYi6ACxeq0/Aq8CpAJhsL7+xdoAv4HC5Aq1aT+czmdFMcpRNOkiAJa2jA7dlLsn07vPc+OtsDVyegvR33yCPQ3l4yZkFAfPwYNjKN5/uzsf5X3g3NO9vqncnXZRRu2yZ/5Iiiy5crW20UKU6SdB2GSsbGlAwPK/7oIyVjY1NtOo5LJMw/+qh8XbacfOPe2dJaM8Ec7+wF70x+9iz5hfPlmxcrbF+tcOdORW+/nYLI56dAFH9rXLGk/PPPy+eaag4k00bxwn2zd3a0lIJBIc3uaJf/21/T9rrv15rMNcnv3y9Jii6cl+/ulr94UdH4mKKBSwoPH1L+gQfkGxuqje/3zrLldoscKM5ng8AO4M+Y3V4krDU0Ym0r0tD29BBEITZndkqwQ4fRM3uxkRGUcSCwJMG8ry4+fwG+lo3ly+fBaWN5Ntbp9PTD0dIfuRwsXw7/HYLz56GlFZYuS9tv71kYGExzf+IaXLuW3lca/z3wIDBePYwGVeeBIpAzBRC/AtDEBDpxguT0KVQE0NKS1v5L/Zhq1nqAEPgm8JVsrPHrnRFrnpB8JjDvbIsP+LuHxEMcQhKuWqn8k99RuG+f/F2fTktyGuPEO4u9s7x39qJ3trwW1254OJ3hdLyuMLp9HmklSXqowShWxGvAycLh9KVsrIGZdN0UgOttLjD5FqCp0IUvZ2P13czeavk//8/GjIjO730AAAAASUVORK5CYII=" type="image/x-icon"/>
    <title>Helper</title>
    <link href="style.css" rel="stylesheet">
    <script src="//code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js" type="text/javascript"></script>
    <script>

        $(function(){
            
            var title_orig = document.title;
            
            var updateRates = function(){
                $.getJSON("https://apiv2.bitcoinaverage.com/exchanges/USD", function(data){
                    var total_volume = 0.0;
                    for(var symb in data){ 
                        try{
                            $(".ticker."+symb+" .price").html(data[symb].rates.last);
                            $(".ticker."+symb+" .volume").html("vol: " + Math.round(data[symb].volume_btc));
                            total_volume += data[symb].volume_btc;
                        }
                        catch(e){}
                        $(".ticker.average .volume").html("vol: " + Math.round(total_volume));
                    }
                })
                $.getJSON("https://api.bitcoinaverage.com/ticker/global/USD/last", function(data){
                    document.title = data + " USD/BTC - " + title_orig;    
                    $(".ticker.average .price").html(data);
                })
            }
            
            setInterval(updateRates, 30 * 1000);
            
            
            
            
            var chart_width = 940;
            
            if($.cookie('chart_width') > 0){
                chart_width = $.cookie('chart_width');
                $('.set-chart-width').show();
                $('.set-chart-width[data-new-width='+chart_width+']').hide();
            }

            var symbol_colors = {btcnCNY: 'green', mtgoxUSD: 'red', bitstampUSD: 'blue', btceUSD: '#336699'}
            
            var getSrc = function(exchanger, days, interval, volume_in_currency, log){
                var params = "width="+chart_width+"&m="+exchanger+"&SubmitButton=Draw&c=0&s=&e=&Prev=&Next=&t=S&b=&a1=&m1=10&a2=&m2=25&x=0&i1=&i2=&i3=&i4=&v=1&cv="+volume_in_currency+"&ps=0&l="+log+"&p=0&";
                var src = "https://bitcoincharts.com/charts/chart.png?" + params;
                
                src += "&r="+days+"&i="+interval+"&rand="+new Date().getTime();
                return src;
            }

            var setChartWidth = function(val){
                $.cookie('chart_width', val, { expires: 365 });
                document.location.reload();
            }

            $(".set-chart-width").click(function(){
                setChartWidth($(this).data('new-width'));
            });
            
            $(".chart_row").width(chart_width);

            $(document).on("click", ".days", function(){
                var days = $(this).data("days");
                var $row = $(this).closest(".chart_row");
                var interval = "";
                var volume_in_currency  = $("input.vol_in_cur", $row).is(":checked") ? 1 : 0; 
                var log_scale           = $("input.log_scale", $row).is(":checked") ? 1 : 0; 
                if(days == 1)  interval = "5-min";
                if(days == 30) interval = "2-hour";
                if(days == 90) interval = "6-hour";
                if(days == 182) interval = "12-hour";
                $(".chart img", $row).css("opacity", "0.6");
                $(".chart img", $row).unbind("error");
                $(".chart img", $row).bind("error", function(arg, arg2){   
                    console.log(arg);
                });
                $(".chart img", $row).attr("src", getSrc($row.data("exchanger"), days, interval, volume_in_currency, log_scale));
                $(".chart .oversign", $row).html($row.data("exchanger"));
                
                $(".chart .oversign", $row).css('color', symbol_colors[$row.data("exchanger")]);
                $(".chart img", $row).unbind("load");
                $(".chart img", $row).bind("load", function(){   
                    $(".chart img", $row).css("opacity", "1");
                });
                $(".days", $row).removeClass("active");
                $(this).addClass("active");
                
                // Обновляем курс в заголовке страницы
                updateRates();
            });

            $(document).on("click", ".change_exchanger", function(){
                var $row = $(this).closest(".chart_row");
                $row.data("exchanger", $(this).data("symbol"));
                $(".change_exchanger", $row).removeClass("active");
                $(this).addClass("active");

                $("button.days.active", $row).click();
            })

            $(document).on("click", "input[type=checkbox]", function(){
                var $row = $(this).closest(".chart_row");
                $("button.days.active", $row).click();
            });

            $(".add_row").click(function(){
                $(".chart_row").last().clone(true).insertAfter($(".chart_row").last());
                $(this).remove();
            });
            
            $(".chart img").click(function(){
                var $row = $(this).closest(".chart_row");
                $("button.days.active", $row).click();
            });

            $(".default").click();

        })
    </script>
</head>
<body>
    <div class="tac">
        Price Chart
        <br><br>
    </div>

    <div class="tickers tac">
        <div class="ticker average">
            <div><a href="https://bitcoinaverage.com">average</a></div>
            <div class="price">...</div>
            <div class="volume"></div>
        </div>
        <div class="ticker bitstamp">
            <div>bitstamp</div>
            <div class="price">...</div>
            <div class="volume"></div>
        </div>
        <div class="ticker btce">
            <div>btce</div>
            <div class="price">...</div>
            <div class="volume"></div>
        </div>
        <div class="ticker bitfinex">
            <div>bitfinex</div>
            <div class="price">...</div>
            <div class="volume"></div>
        </div>
    </div>
    
    <div class="charts">
        <div class="chart_row" data-exchanger="bitstampUSD">
            <div class="buttons">
                <button class="days" data-days="999999">All time</button>
                <button class="days" data-days="365">1 year</button>
                <button class="days" data-days="182">6 mon.</button>
                <button class="days" data-days="90">3 mon.</button>
                <button class="days" data-days="30">30 days</button>
                <button class="days" data-days="10">10 days</button>
                <button class="days default" data-days="2">2 days</button>
                <button class="days" data-days="1">1 day</button>
                &nbsp;&nbsp;&nbsp;
                <a href="javascript:;" class="change_exchanger active" data-symbol="bitstampUSD" title="Большая европейская биржа">bitstamp</a>
                &nbsp;
                <a href="javascript:;" class="change_exchanger" data-symbol="btceUSD" title="Русская биржа">btce</a>
                &nbsp;
                <a href="javascript:;" class="change_exchanger" data-symbol="bitfinexUSD">bitfinex</a>
                &nbsp;
                <a href="javascript:;" class="change_exchanger" data-symbol="btcnCNY" title="Китайская биржа">btcn</a>
                &nbsp;
                <a href="javascript:;" class="change_exchanger" data-symbol="mtgoxUSD" title="Самая первая биржа" style="color: #ccc;">mtgox</a>
                <br>
                <br>
                <label><input type="checkbox" style="vertical-align: middle;" class="vol_in_cur"> Объем в валюте</label>
                <label><input type="checkbox" style="vertical-align: middle;" class="log_scale" checked="checked"> Логарифмическая шкала</label>
                
                <div style="float: right;">
                    <a href="javascript:;" class="set-chart-width" data-new-width="1820">1820px</a>
                    <a href="javascript:;" class="set-chart-width" data-new-width="1280">1280px</a>
                    <a href="javascript:;" class="set-chart-width" data-new-width="940" style="display: none;">940px</a>
                </div>
            </div>
            
            <div class="chart">
                <div class="oversign">Name Of Exchanger Here</div>
                <img>
            </div>
            
            <a href="javascript:;" class="add_row pale">Clone chart</a>
        </div>
    </div>    
    
    <div style="text-align: right;">
        <a href="http://bitcoincharts.com/" style="font-size: 10px; font-family: Tahoma">bitcoincharts.com</a>
    </div>


</body>
</html>
